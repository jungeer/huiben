<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â∞èÊÖß&‰øäÂì• - Êµ™Êº´‰πãÊóÖ</title>
    <style>
      /* Custom Font */
      @font-face {
        font-family: "CustomSerif";
        src: url("https://lf-code-agent.coze.cn/obj/x-ai-cn/fonts/space/14-Â≠óËØ≠ÊñáÂàª‰Ωì.woff2")
          format("woff2");
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }

      * {
        box-sizing: border-box;
      }

      :root {
        /* Responsive book dimensions based on viewport */
        --book-max-width: 90vw;
        --book-max-height: 90vh;
        /* Cleaner, brighter paper color */
        --page-bg: #fffbf0;
        --text-color: #2c3e50;
        --accent-color: #7a644e;
        /* Subtler texture */
        --paper-texture: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmRmNmUzIiBvcGFjaXR5PSIwIi8+CjxyZWN0IHdpZHRoPSI0IiBoZWlnaHQ9IjQiIGZpbGw9IiMwMDAiIG9wYWNpdHk9IjAuMDIiLz4KPC9zdmc+");
        --bgm-url: "https://lf3-static.bytednsdoc.com/obj/eden-cn/nulmubfbs/%E6%B5%81%E8%A1%8C%E5%B0%A4%E5%85%8B%E9%87%8C%E9%87%8C-%E6%AC%A2%E5%BF%AB%E6%B8%85%E6%96%B0-%E4%BF%8F%E7%9A%AE%E7%9A%84%E4%B8%80%E5%A4%A9_%E7%88%B1%E7%BB%99%E7%BD%91_aigei_com.mp3";
      }

      body {
        margin: 0;
        padding: 0;
        background: radial-gradient(circle at center, #3c322a 0%, #12100e 100%);
        font-family: "CustomSerif", "Microsoft YaHei", "PingFang SC", serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        overflow: hidden;
        color: #fff;
      }

      .book-container {
        /* 5:7 aspect ratio (A4-like) responsive sizing */
        width: min(
          var(--book-max-width),
          calc(var(--book-max-height) * 2 * 5 / 7)
        );
        height: min(
          var(--book-max-height),
          calc(var(--book-max-width) * 7 / 10)
        );
        position: relative;
        perspective: 2000px;
        /* Sync transition with page flip (1.2s) for natural opening */
        transition: transform 1s cubic-bezier(0.15, 1, 0.5, 1);
      }

      /* Mobile Adaptation - High-End Experience */
      /* --- Mobile View Container (Distinct from Desktop) --- */
      #mobile-book-container {
        display: none;
        /* Hidden by default on Desktop */
        width: var(--book-max-width);
        height: var(--book-max-height);
        position: relative;
        perspective: 1500px;
        overflow: visible;
        /* changed from hidden to visible to avoid clipping shadows */
        z-index: 5;
        margin-top: -50px;
        /* Align with desktop feel */
      }

      .mobile-sheet {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #fffdf5;
        border-radius: 20px;
        /* Rounded corners for mobile card feel */
        transform: translate3d(0, 0, 0);
        will-change: transform;
        transition: transform 0.3s ease;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);

        /* Layout: Flex Column for Image + Text */
        display: flex;
        flex-direction: column;
      }

      .mobile-sheet.flipped {
        transform: translate3d(-100%, 0, 0);
        pointer-events: none;
        /* Let clicks pass to next page */
      }

      /* Mobile Content Areas */
      .mobile-image-area {
        flex: 1;
        /* Image takes available space */
        width: 100%;
        position: relative;
        background: #000;
        border-radius: 20px 20px 0 0;
        overflow: hidden;
      }

      .mobile-image-area img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* Cover Special Styling */
      .mobile-sheet.is-cover .mobile-image-area {
        flex: 1;
        /* Simple flex expansion */
        height: 100%;
        border-radius: 20px;
      }

      .mobile-sheet.is-cover .mobile-text-area {
        display: none;
      }

      .mobile-text-area {
        flex: 0 0 auto;
        min-height: 35%;
        /* Ensure minimum space for text */
        max-height: 50%;
        /* Allow more room for text */
        padding: 24px 20px 100px;
        /* Extra bottom padding to clear controls bar */
        background: #fffdf5;
        overflow-y: auto;
        border-radius: 0 0 20px 20px;
        box-sizing: border-box;
        position: relative;
        color: #332a1e;
        font-size: 18px;
        /* Larger base font */
        line-height: 1.6;
      }

      /* Mobile Cover Title Overlay */
      .mobile-cover-title {
        position: absolute;
        bottom: 0;
        /* Anchor to bottom of image area */
        left: 0;
        width: 100%;
        padding: 40px 20px 30px;
        /* More generous padding */
        color: white;
        text-align: center;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.85) 0%,
          rgba(0, 0, 0, 0.5) 50%,
          transparent 100%
        );
        pointer-events: none;
        border-radius: 0 0 20px 20px;
        /* Match card corners */
      }

      .mobile-cover-title h1 {
        margin: 0 0 8px;
        font-size: 28px;
        /* Larger title */
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }

      .mobile-cover-title p {
        margin: 0;
        font-size: 16px;
        opacity: 0.9;
      }

      /* Mobile Specific Overrides */
      @media (max-width: 768px) {
        .background-layer {
          display: none;
          /* Simplified bg */
        }

        .book-container {
          display: none !important;
          /* Hide Desktop Book */
        }

        #mobile-book-container {
          display: block;
          /* Show Mobile Book */
        }

        /* Adjust Controls for mobile */
        .controls {
          z-index: 100;
          /* Above sheets */
        }

        :root {
          --book-max-width: 94vw;
          --book-max-height: 85vh;
        }

        body {
          background: #0f0d0b;
          background-image: radial-gradient(
            circle at top,
            #2d2620 0%,
            #0f0d0b 100%
          );
          overflow: hidden;
          touch-action: none;
        }

        .book-container {
          width: var(--book-max-width);
          height: var(--book-max-height);
          perspective: none;
          /* Disable 3D on mobile */
          transform: none !important;
          margin-top: -60px;
        }

        /* Mobile Card Stack Logic: Sheets are stacked, top one slides away */
        .sheet {
          width: 100% !important;
          height: 100% !important;
          left: 0 !important;
          transform-origin: center center !important;
          transition: transform 0.6s cubic-bezier(0.2, 0, 0.2, 1), opacity 0.6s,
            visibility 0.6s;
          transform-style: flat !important;
          /* Flatten 3D space */
          visibility: visible;
          opacity: 1;
        }

        /* "Flipped" means "Read/Done", so slide it away to reveal next page */
        .sheet.flipped {
          transform: translateX(-120%) scale(0.9) !important;
          opacity: 0;
          visibility: hidden;
        }

        /* Mobile Flip Fix: Center Origin & Pointer Events */
        .book-container {
          width: var(--book-max-width);
          height: var(--book-max-height);
          perspective: 1500px;
          transform: none !important;
          margin-top: -50px;
        }

        .sheet {
          width: 100% !important;
          height: 100% !important;
          left: 0 !important;
          /* Center flip ensures visual stays on screen */
          transform-origin: center center !important;
          transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
          transform-style: preserve-3d !important;
          display: block !important;
          clip-path: none !important;
          box-shadow: none !important;
          background: transparent !important;

          /* CRITICAL: Allow clicks to pass through empty parts of the sheet */
          pointer-events: none !important;
        }

        .sheet.flipped {
          transform: rotateY(-180deg) !important;
          opacity: 1 !important;
          visibility: visible !important;
          z-index: 1000 !important;
        }

        .sheet-face {
          position: absolute !important;
          top: 0 !important;
          left: 0 !important;
          width: 100% !important;
          /* Re-enable clicks on actual content faces */
          pointer-events: auto !important;
          backface-visibility: hidden !important;
          box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2) !important;
          display: flex !important;
          flex-direction: column;
        }

        /* Front Face (Text Page): Bottom Half */
        .sheet-front {
          top: 50% !important;
          height: 50% !important;
          background: #fffdf5 !important;
          z-index: 2;
          transform: rotateY(0deg);
          border-radius: 0 0 20px 20px !important;
        }

        /* Back Face (Image Page): Top Half */
        .sheet-back {
          top: 0 !important;
          height: 50% !important;
          background: #000 !important;
          z-index: 1;
          transform: rotateY(180deg);
          border-radius: 20px 20px 0 0 !important;
        }

        /* --- Special Case: Cover (Sheet 0 Front) --- */
        /* Must be Full Screen, starting at Top */
        #sheet-0 .sheet-front {
          top: 0 !important;
          height: 100% !important;
          border-radius: 20px !important;
          z-index: 10;
        }

        /* Ensure Cover Image Fills */
        #sheet-0 .cover-image {
          height: 100% !important;
          width: 100% !important;
          border-radius: 20px !important;
        }

        /* Inner Content Styling */
        .page-image,
        .cover-image {
          width: 100% !important;
          height: 100% !important;
          object-fit: cover;
          border-radius: 20px 20px 0 0 !important;
        }

        .page-text-container {
          position: absolute !important;
          top: 0 !important;
          left: 0 !important;
          width: 100% !important;
          height: 100% !important;
          padding: 20px 20px 50px !important;
          background: transparent !important;
          overflow-y: auto !important;
          box-sizing: border-box;
          -webkit-overflow-scrolling: touch;
        }

        /* Divider */
        .sheet-front::before {
          content: "";
          position: absolute;
          top: 0;
          left: 20px;
          right: 20px;
          height: 1px;
          background: rgba(122, 100, 78, 0.15);
          z-index: 10;
          display: block !important;
          opacity: 1;
        }

        /* Remove old divider */
        .sheet-front::after {
          display: none !important;
        }

        /* Cover Special Case */
        #sheet-0 .sheet-back {
          height: 0 !important;
          display: none;
        }

        /* No back image for cover */
        #sheet-0 .sheet-front {
          height: 100% !important;
          top: 0 !important;
          border-radius: 24px !important;
        }

        /* Revert Cover Text container */
        #sheet-0 .page-text-container {
          display: none;
          /* Cover usually uses overlay, not text container? */
        }

        /* Actually cover content is usually in .sheet-front directly or implicit? */
        /* Checking Template: Cover image is in .sheet-front usually? */
        /* Wait, Template Logic:
               Pages[0] (Cover) -> type='cover'.
               Cover structure:
               <div class="sheet-front"> <img cover> <overlay>...</div>
               <div class="sheet-back"> (Page 1 Image) </div>
             */

        /* If Sheet 0 Front is Cover HTML. */
        /* We want Sheet 0 Front only on Sheet 0. */
        #sheet-0 .sheet-front {
          height: 100% !important;
          top: 0 !important;
          border-radius: 24px !important;
          display: block !important;
          overflow: hidden;
        }

        #sheet-0 .sheet-back {
          display: none !important;
          /* Hide Page 1 Image on mobile cover view? */
          /* If we hide it, user sees Cover. Then 'Next' -> Flipped. */
          /* Sheet 0 slides away. Reveal Sheet 1. */
          /* Sheet 1 has Page 1 Text? And Page 2 Image? */
          /* If Sheet 0 Back was Page 1 Image, we lose it? */
          /* YES. This is the pairing issue. */
          /* "Odd=Image, Even=Text".
                   Sheet 0: Cover (Front), Page 1 (Back)?
                */
        }

        /* If Sheet 0 Back IS Page 1 Image, we must show it on Sheet 1 view?
               No, logic is fixed. Sheet 0 Back is physically attached to Sheet 0.
               If I slide Sheet 0 away, I lose Sheet 0 Back.
               Solution:
               If Mobile View requires re-grouping, CSS only is hard if DOM is grouped by Sheet.
            */

        /* Pure cleanup of previous rules */

        .page-image,
        .cover-image {
          height: 100% !important;
          width: 100% !important;
          object-fit: cover;
          border-radius: 24px 24px 0 0 !important;
        }

        .page-text-container {
          position: absolute;
          top: 58%;
          height: 42% !important;
          width: 100% !important;
          padding: 30px 24px 50px !important;
          background: transparent !important;
          /* Use sheet-front bg */
          overflow-y: auto !important;
          display: flex !important;
          flex-direction: column;
          justify-content: flex-start;
          text-align: left;
          font-size: clamp(18px, 5.5vw, 24px) !important;
          line-height: 1.6;
          color: #332a1e;
          box-sizing: border-box;
        }

        /* Page divider line */
        .sheet-front::after {
          content: "";
          position: absolute;
          top: 58%;
          left: 0;
          width: 100%;
          height: 2px;
          background: rgba(122, 100, 78, 0.1);
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
          z-index: 10;
          display: block !important;
          transform: none !important;
        }

        /* Premium Controls */
        .controls {
          width: calc(100% - 24px);
          max-width: 450px;
          bottom: 20px;
          padding: 8px 12px;
          gap: 8px;
          background: rgba(45, 38, 32, 0.9);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          border-radius: 50px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
          flex-wrap: nowrap;
          justify-content: space-between;
          align-items: center;
          height: 60px;
          box-sizing: border-box;
        }

        .btn {
          width: 40px;
          height: 40px;
          font-size: 1.1rem;
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.1);
          color: #d4bda8;
          border-radius: 50%;
          flex-shrink: 0;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          line-height: 1;
        }

        .btn-large {
          width: 40px !important;
          height: 40px !important;
          border-radius: 50% !important;
          padding: 0 !important;
        }

        .btn-print {
          flex: 1;
          margin-left: 4px;
          height: 40px !important;
          border-radius: 20px !important;
          font-size: 0.95rem !important;
          background: linear-gradient(
            135deg,
            #a88665 0%,
            #7a644e 100%
          ) !important;
          color: #fff !important;
          border: none !important;
          font-weight: 700 !important;
          white-space: nowrap !important;
          /* Force one line */
          display: flex;
          align-items: center;
          justify-content: center;
        }

        /* Correct Play Button Shape */
        #playPauseBtn {
          width: 44px !important;
          height: 44px !important;
          border-radius: 50% !important;
          flex: 0 0 44px !important;
          /* Prevent squishing */
        }

        #playPauseBtn span:not(#playIcon) {
          display: none !important;
        }

        .btn-print {
          font-size: 0 !important;
          /* Hide original long text */
        }

        .btn-print::after {
          content: "ÂØºÂá∫ PDF";
          font-size: 0.95rem;
          font-weight: 700;
        }

        /* ‰ºòÂÖàÁ∫ßÈöêËóèÈÄªËæë (Priority Hiding Logic for Narrow Views) */
        @media (max-width: 420px) {
          #muteBtn {
            display: none !important;
          }
        }

        @media (max-width: 360px) {
          #prevBtn,
          #nextBtn {
            display: none !important;
          }
        }

        @media (max-width: 300px) {
          #playPauseBtn {
            display: none !important;
          }
        }

        .page-number {
          bottom: 15px;
          color: #8b7355;
        }
      }

      /* Dynamic Shadow Element */
      .book-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 5px;
        box-shadow: 0 30px 60px -10px rgba(0, 0, 0, 0.4);
        /* Wait 1s (page turn duration) then snap to full width/pos */
        transition: width 0s 1s, left 0s 1s;
        z-index: -1;
      }

      /* 3D Spine Effect */
      .book-container::after {
        content: "";
        position: absolute;
        top: 0;
        left: 50%;
        margin-left: -20px;
        /* Center the 40px spine */
        width: 40px;
        /* Spine width */
        height: 100%;
        background: #2c3e50;
        /* Spine color */
        transform: rotateY(90deg) translateZ(-20px);
        /* Position spine behind hinge */
        transform-origin: center;
        z-index: -2;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
      }

      /* Centering state for closed book */
      .book-container.closed {
        transform: translateX(-25%);
      }

      /* Hide spine when closed to prevent artifact */
      .book-container.closed::after {
        opacity: 0;
      }

      /* Adjust shadow when closed to only show under the cover (right half) */
      .book-container.closed::before {
        width: 50%;
        left: 50%;
        border-radius: 5px;
        /* Instant reset when closing */
        transition: width 0s, left 0s;
      }

      /* Hide left base when closed to show single cover */
      /* Hide left base when closed to show single cover */
      .book-container.closed #base-left {
        opacity: 0;
        pointer-events: none;
      }

      /* When open, show base-left smoothly */
      /* When open, show base-left smoothly */
      #base-left {
        opacity: 0;
        /* Keep hidden as it causes white flash and is covered by pages */
      }

      /* Base Layers (Fixed) */
      .base-layer {
        position: absolute;
        top: 0;
        width: 50%;
        height: 100%;
        background-color: var(--page-bg);
        background-image: var(--paper-texture);
        overflow: hidden;
      }

      #base-left {
        left: 0;
        border-radius: 24px 0 0 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #fff;
        /* Softer spine shadow */
        box-shadow: inset -30px 0 50px -20px rgba(0, 0, 0, 0.1);
      }

      #base-right {
        right: 0;
        border-radius: 0 24px 24px 0;
        display: flex;
        justify-content: center;
        align-items: center;
        /* Softer spine shadow */
        box-shadow: inset 30px 0 50px -20px rgba(0, 0, 0, 0.1);
      }

      /* Page Thickness Effect - Refined */
      #base-right::after {
        content: "";
        position: absolute;
        right: 0;
        top: 3px;
        bottom: 3px;
        width: 6px;
        background: linear-gradient(to right, #ddd, #fdfdfd);
        border-radius: 0 24px 24px 0;
        transform: translateX(100%);
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }

      /* Sheets (Flippable) */
      .sheet {
        position: absolute;
        top: 0;
        right: 0;
        /* Initially on the right */
        width: 50%;
        height: 100%;
        transform-origin: left center;
        transform: translateZ(0);
        will-change: transform;
        transform-style: preserve-3d;
        transition: transform 1s cubic-bezier(0.15, 1, 0.5, 1);
        z-index: 10;
      }

      /* Staggered Animation Timing (Slower & More Natural) */
      #sheet-0 {
        transition-duration: 2.2s;
      }

      /* Cover moves very slowly */
      #sheet-1 {
        transition-duration: 1.8s;
      }

      #sheet-2 {
        transition-duration: 1.6s;
      }

      #sheet-3 {
        transition-duration: 1.5s;
      }

      #sheet-4 {
        transition-duration: 1.4s;
      }

      #sheet-5 {
        transition-duration: 1.3s;
      }

      .sheet.flipped {
        transform: rotateY(-180deg) translateZ(0);
      }

      .sheet-face {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        background-color: #fff;
        /* Realistic Paper Gradient from Reference */
        background: linear-gradient(to right, #e1ddd8 0%, #fffbf6 100%);
        box-shadow: inset 0px -1px 2px rgba(50, 50, 50, 0.1),
          inset -1px 0px 1px rgba(150, 150, 150, 0.2);
        overflow: hidden;
        display: flex;
        cursor: pointer;
      }

      /* Front Face (Right Page - Text) */
      .sheet-front {
        z-index: 2;
        border-radius: 0 24px 24px 0;
        /* Softer spine shadow */
        box-shadow: inset 20px 0 50px -15px rgba(0, 0, 0, 0.05);
      }

      /* Lighting Overlay for Front Face */
      .sheet-front::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          to right,
          rgba(0, 0, 0, 0.1) 0%,
          rgba(0, 0, 0, 0) 100%
        );
        opacity: 0;
        transition: opacity 0.5s ease-in;
        pointer-events: none;
      }

      /* When flipped, front face goes into shadow */
      .sheet.flipped .sheet-front::before {
        opacity: 1;
      }

      /* Back Face (Left Page - Image) */
      /* Back Face (Left Page - Image) */
      .sheet-back {
        transform: rotateY(180deg);
        z-index: 1;
        border-radius: 24px 0 0 24px;
        /* Reverse Gradient for Back Face */
        background: linear-gradient(to left, #e1ddd8 0%, #fffbf6 100%);
        justify-content: center;
        align-items: center;
        box-shadow: inset 0px -1px 2px rgba(50, 50, 50, 0.1),
          inset 1px 0px 1px rgba(150, 150, 150, 0.2);
      }

      /* Lighting Overlay for Back Face */
      .sheet-back::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          to right,
          rgba(0, 0, 0, 0.1) 0%,
          rgba(0, 0, 0, 0) 100%
        );
        opacity: 1;
        /* Starts in shadow (facing right) */
        transition: opacity 0.5s ease-out 0.5s;
        /* Delay to match flip */
        pointer-events: none;
      }

      /* When flipped, back face comes out of shadow */
      .sheet.flipped .sheet-back::before {
        opacity: 0;
      }

      /* Generic Page Thickness (Right Edge) */
      .sheet-front::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 2px;
        /* Inner pages are thinner */
        height: 100%;
        background: #e0e0e0;
        transform: rotateY(90deg) translateZ(1px);
        transform-origin: right;
      }

      /* Special styling for Cover Sheet Front (Thicker) */
      #sheet-0 .sheet-front {
        border-radius: 0 24px 24px 0;
        /* Spine side flat, opening side rounded */
        /* Removed inset spine shadow for cleaner cover */
        box-shadow: 5px 0 15px rgba(0, 0, 0, 0.05);
        background: var(--page-bg);
      }

      /* Cover Thickness (Thicker than pages) */
      #sheet-0 .sheet-front::after {
        width: 6px;
        background: #ccc;
        transform: rotateY(90deg) translateZ(3px);
      }

      /* Ensure cover front overlay behaves correctly */
      #sheet-0 .sheet-front::before {
        display: none;
        /* Remove gradient overlay to fix shadow line artifact */
      }

      /* Corner Peel Effect */
      /* Right Page (Next) Peel */
      .sheet-front::after {
        content: "";
        position: absolute;
        bottom: 0;
        right: 0;
        width: 0;
        height: 0;
        background: linear-gradient(
          135deg,
          transparent 45%,
          #d0d0d0 50%,
          #f0f0f0 56%,
          #fff 80%
        );
        box-shadow: -2px -2px 5px rgba(0, 0, 0, 0.1);
        transition: width 0.3s ease, height 0.3s ease, background 0.3s;
        pointer-events: none;
        /* Let clicks pass through */
        border-radius: 5px 0 0 0;
      }

      .sheet-front:hover::after {
        width: 80px;
        height: 80px;
        background: linear-gradient(
          135deg,
          transparent 45%,
          #e0e0e0 50%,
          #fff 56%,
          #fff 80%
        );
        box-shadow: -5px -5px 10px rgba(0, 0, 0, 0.15);
      }

      /* Left Page (Prev) Peel - Applied to sheet-back */
      .sheet-back::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 0;
        background: linear-gradient(
          225deg,
          transparent 45%,
          #d0d0d0 50%,
          #f0f0f0 56%,
          #fff 80%
        );
        box-shadow: 2px -2px 5px rgba(0, 0, 0, 0.1);
        transition: width 0.3s ease, height 0.3s ease;
        pointer-events: none;
        border-radius: 0 5px 0 0;
      }

      .sheet-back:hover::after {
        width: 80px;
        height: 80px;
        background: linear-gradient(
          225deg,
          transparent 45%,
          #e0e0e0 50%,
          #fff 56%,
          #fff 80%
        );
        box-shadow: 5px -5px 10px rgba(0, 0, 0, 0.15);
      }

      /* Disable peel on Cover Front (Sheet 0) if desired, or keep it */
      /* Disable peel on Cover Front (Sheet 0) */
      #sheet-0 .sheet-front:hover::after {
        width: 0;
        height: 0;
      }

      /* Content Styling */
      .page-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 3px;
      }

      .image-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
        background: linear-gradient(
          135deg,
          rgba(0, 0, 0, 0.62),
          rgba(0, 0, 0, 0.22)
        );
        color: rgba(255, 255, 255, 0.96);
        text-align: center;
        border-radius: 3px;
      }

      .image-error-text {
        font-size: 1.35rem;
        line-height: 1.6;
        max-width: 85%;
      }

      .mobile-image-area .image-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        padding: 24px;
        border-radius: inherit;
        background: linear-gradient(
          135deg,
          rgba(0, 0, 0, 0.7),
          rgba(0, 0, 0, 0.25)
        );
      }

      /* Multiply blend mode for better integration with paper texture if background was visible,
           but images usually cover it. */

      /* Cover Image Styling */
      .cover-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 0 24px 24px 0;
        /* Match container radius exactly */
      }

      .cover-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 60px 40px;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.7) 0%,
          rgba(0, 0, 0, 0.4) 50%,
          transparent 100%
        );
        color: white;
        text-align: center;
        box-sizing: border-box;
        border-radius: 0 0 24px 0;
        /* Match container bottom corners (BL:0, BR:15) */
      }

      .cover-overlay h1 {
        font-size: 3.5rem;
        /* Increased desktop title */
        margin: 0 0 15px 0;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
        /* Font family inherited from body */
        letter-spacing: 2px;
      }

      .cover-overlay h2 {
        font-size: 1.6rem;
        /* Increased desktop author */
        margin: 0;
        opacity: 0.9;
        font-weight: 300;
        letter-spacing: 1px;
      }

      .cover-error {
        display: inline-block;
        margin-top: 16px;
        padding: 10px 14px;
        border-radius: 14px;
        background: rgba(0, 0, 0, 0.42);
        border: 1px solid rgba(255, 255, 255, 0.18);
        font-size: 1.1rem;
        line-height: 1.5;
      }

      .share-tip-banner {
        position: fixed;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        width: min(760px, calc(100vw - 24px));
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 12px;
        padding: 10px 12px;
        border-radius: 14px;
        background: rgba(255, 251, 240, 0.78);
        border: 1px solid rgba(224, 213, 193, 0.6);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.14);
        z-index: 1990;
        color: #2c3e50;
        font-size: 0.88rem;
        line-height: 1.45;
      }

      .share-tip-banner.hidden {
        display: none;
      }

      .share-tip-text {
        flex: 1;
        min-width: 0;
      }

      .share-tip-close {
        background: transparent;
        border: none;
        color: #7a644e;
        font-size: 1rem;
        line-height: 1;
        padding: 4px;
        cursor: pointer;
        border-radius: 10px;
        flex: 0 0 auto;
      }

      .share-tip-close:hover {
        background: rgba(122, 100, 78, 0.12);
      }

      @media (max-width: 480px) {
        .share-tip-banner {
          top: 10px;
          font-size: 0.82rem;
          padding: 8px 10px;
        }
      }

      .page-text-container {
        width: 100%;
        height: 100%;
        padding: 60px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        /* Vertically center */
        text-align: center;
        /* Horizontally center for better look */
        font-size: 2rem;
        /* Increased default */
        line-height: 1.8;
        color: var(--text-color);
        position: relative;
        word-break: break-all;
        transition: opacity 0.8s ease, transform 0.8s ease, font-size 0.3s ease;

        /* Fade-in Animation Initial State */
        opacity: 0;
        transform: translateY(10px);
      }

      /* Responsive font size based on text length - Increased sizes */
      .page-text-container.short-text {
        font-size: 2.8rem;
      }

      .page-text-container.medium-text {
        font-size: 2.2rem;
      }

      .page-text-container.long-text {
        font-size: 1.8rem;
      }

      .page-text-container.extra-long-text {
        font-size: 1.4rem;
      }

      .page-text-container.visible {
        /* Fade-in Animation Initial State */
        opacity: 1;
        transform: translateY(0);
      }

      /* Active state for text fade-in */
      .page-text-container.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .page-number {
        position: absolute;
        bottom: 30px;
        right: 40px;
        font-size: 1rem;
        color: #95a5a6;
        font-family: Georgia, serif;
      }

      /* Toast notification */
      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 10000;
        animation: slideIn 0.3s ease-out;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: all 0.5s;
      }

      .toast.prominent {
        bottom: 50%;
        left: 50%;
        right: auto;
        transform: translate(-50%, 50%);
        background: #7a644e;
        padding: 24px 48px;
        font-size: 20px;
        border: 2px solid #fff;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
        font-weight: bold;
        text-align: center;
        white-space: normal;
        max-width: 80%;
        border-radius: 15px;
        line-height: 1.5;
        animation: zoomIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }

        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes zoomIn {
        from {
          transform: translate(-50%, 50%) scale(0.5);
          opacity: 0;
        }

        to {
          transform: translate(-50%, 50%) scale(1);
          opacity: 1;
        }
      }

      .toast.hide {
        animation: slideOut 0.3s ease-out forwards;
      }

      .toast.prominent.hide {
        animation: zoomOut 0.3s ease-out forwards;
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }

        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }

      @keyframes zoomOut {
        from {
          transform: translate(-50%, 50%) scale(1);
          opacity: 1;
        }

        to {
          transform: translate(-50%, 50%) scale(0.5);
          opacity: 0;
        }
      }

      /* Controls */
      .controls {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 20px;
        z-index: 1000;
        background: linear-gradient(
          135deg,
          rgba(212, 165, 116, 0.4) 0%,
          rgba(200, 155, 109, 0.5) 50%,
          rgba(184, 138, 94, 0.6) 100%
        );
        backdrop-filter: blur(20px);
        padding: 12px 30px;
        border-radius: 50px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
        cursor: pointer;
        font-size: 1.2rem;
        color: white;
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        align-items: center;
        justify-content: center;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .btn:hover {
        background-color: var(--accent-color);
        color: white;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(122, 100, 78, 0.4);
      }

      .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn.active {
        background-color: var(--accent-color);
        color: white;
        box-shadow: 0 0 20px rgba(122, 100, 78, 0.5);
      }

      .btn-large {
        width: auto;
        padding: 0 25px;
        border-radius: 30px;
        font-weight: bold;
        font-size: 1rem;
      }

      .restart-btn {
        margin-top: 40px;
        padding: 12px 30px;
        background-color: var(--accent-color);
        color: white;
        border: none;
        border-radius: 30px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s;
        align-self: center;
        box-shadow: 0 5px 15px rgba(122, 100, 78, 0.4);
      }

      .restart-btn:hover {
        background-color: #5f4d3a;
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(122, 100, 78, 0.5);
      }

      /* Progress Bar */
      .progress-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 6px;
        background: rgba(0, 0, 0, 0.1);
        z-index: 2000;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(to right, #7a644e, #8b7355);
        width: 100%;
        transform: scaleX(0);
        transform-origin: left center;
        transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 0 10px rgba(122, 100, 78, 0.5);
      }

      /* New Print Button Style (Warm Theme) */
      .btn-print {
        width: auto !important;
        padding: 0 35px !important;
        border-radius: 50px !important;
        background: #7a644e !important;
        color: white !important;
        font-weight: 800;
        font-size: 1.1rem;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2) !important;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
      }

      .btn-print:hover {
        background: #5f4d3a !important;
        transform: translateY(-5px) !important;
        box-shadow: 0 15px 30px rgba(122, 100, 78, 0.4) !important;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <div
      id="shareTipBanner"
      class="share-tip-banner"
      role="note"
      aria-live="polite"
    >
      <div class="share-tip-text">
        Âú®ÂÆåÊàê‰∏ãÂçïÊµÅÁ®ãÂâçÔºåËØ∑Ë∞®ÊÖéÂàÜ‰∫´ËØ•È°µÈù¢ÔºõÂª∫ËÆÆÂÆåÊàêÂïÜÂìÅ‰∏ãÂçïÁßØÂàÜÂÖëÊç¢ÂêéÔºåÂÜçÂàÜ‰∫´„ÄÇ
      </div>
      <button
        class="share-tip-close"
        onclick="dismissShareTip()"
        aria-label="ÂÖ≥Èó≠ÊèêÁ§∫"
      >
        ‚úï
      </button>
    </div>

    <div class="book-container closed" id="book">
      <!-- Base Layers -->
      <div id="base-left" class="base-layer"></div>
      <div id="base-right" class="base-layer"></div>
      <!-- Sheets will be injected here -->
    </div>

    <!-- Mobile View Container -->
    <div id="mobile-book-container"></div>

    <div class="controls">
      <button class="btn" id="prevBtn" title="‰∏ä‰∏ÄÈ°µ">‚Üê</button>
      <button class="btn btn-large" id="playPauseBtn" title="Ëá™Âä®Êí≠Êîæ">
        <span id="playIcon">‚ñ∂</span>
        <span style="margin-left: 8px; font-size: 1rem">Ëá™Âä®Êí≠Êîæ</span>
      </button>
      <button class="btn" id="muteBtn" title="ÈùôÈü≥">üîä</button>
      <button class="btn" id="nextBtn" title="‰∏ã‰∏ÄÈ°µ">‚Üí</button>
      <button
        class="btn btn-print"
        onclick="window.open('index-print.html','_blank');"
        title="ÂØºÂá∫ PDFÔºàÊâìÂºÄÊâìÂç∞ÁâàÂêéÊåâ Ctrl+P Âè¶Â≠ò‰∏∫ PDFÔºâ"
      >
        ÂØºÂá∫ PDF
      </button>
      <button
        class="btn btn-print-split"
        onclick="window.open('index-print-split.html','_blank');"
        title="ÂØºÂá∫ PDF¬∑ÂõæÊñáÂàÜÈ°µÔºàÊØèÂº†Âõæ‰∏ÄÈ°µ„ÄÅÊØèÊÆµÊñáÂ≠ó‰∏ÄÈ°µÔºâ"
      >
        ÂØºÂá∫ PDFÔºàÂõæÊñáÂàÜÈ°µÔºâ
      </button>
    </div>

    <audio id="audioPlayer"></audio>
    <audio id="bgmPlayer" loop>
      <source
        src="https://lf3-static.bytednsdoc.com/obj/eden-cn/nulmubfbs/%E6%B5%81%E8%A1%8C%E5%B0%A4%E5%85%8B%E9%87%8C%E9%87%8C-%E6%AC%A2%E5%BF%AB%E6%B8%85%E6%96%B0-%E4%BF%8F%E7%9A%AE%E7%9A%84%E4%B8%80%E5%A4%A9_%E7%88%B1%E7%BB%99%E7%BD%91_aigei_com.mp3"
        type="audio/mpeg"
      />
    </audio>

    <script>
      // ÈÖçÁΩÆÁ§∫‰æã - Ëá™Âä®ÁîüÊàêÊó∂‰ºöÊõøÊç¢Ê≠§ÈÉ®ÂàÜ
      const PICTUREBOOK_CONFIG = {
        title: "Êµ™Êº´ÂõûÂøÜ",
        author: "Â∞èÊÖß&‰øäÂì•",
        pages: [
          {
            type: "cover",
            title: "Êµ™Êº´ÂõûÂøÜ",
            author: "Â∞èÊÖß&‰øäÂì•",
            image: "images/cover.jpg",
            image_error: "",
          },
          {
            type: "content",
            text: "Âú®ËçßÂπï‰∫ÆËµ∑ÁöÑÈÇ£‰∏ÄÂàªÔºåÊàë‰ª¨Âú®ÂΩºÊ≠§ÁöÑ‰∏ñÁïåÈáåÂá∫Áé∞„ÄÇ",
            image: "images/page-01.jpg",
            image_error: "",
            audio:
              "audios/page-01.mp3",
          },
          {
            type: "content",
            text: "Á¨¨‰∏ÄÊ¨°ÈÄÅÂá∫ÁöÑÁ§ºÁâ©ÔºåËóèÁùÄ‰∏çÊï¢ËØ¥Âá∫Âè£ÁöÑÂú®ÊÑè„ÄÇ",
            image: "images/page-02.jpg",
            image_error: "",
            audio:
              "audios/page-02.mp3",
          },
          {
            type: "content",
            text: "ÂéüÊù•Âπ∏Á¶èÔºå‰πüÂèØ‰ª•ÊòØ‰∏ÄÈ°øÁÉ≠ËÖæËÖæÁöÑÈ•≠„ÄÇ",
            image: "images/page-03.jpg",
            image_error: "",
            audio:
              "audios/page-03.mp3",
          },
          {
            type: "content",
            text: "‰∏ÄÊ≠•‰∏ÄÊ≠•Ëµ∞‰∏äÁöÑÔºå‰∏çÂè™ÊòØÈò∂Ê¢ØÔºåËøòÊúâÊú™Êù•„ÄÇ",
            image: "images/page-04.jpg",
            image_error: "",
            audio:
              "audios/page-04.mp3",
          },
          {
            type: "content",
            text: "Âú®Â§úËâ≤ÂíåËΩ¶ËΩÆÂ£∞ÈáåÔºåÊàë‰ª¨ÊÖ¢ÊÖ¢Ëµ∞ÂêëÊõ¥ËøúÁöÑÂú∞Êñπ„ÄÇ",
            image: "images/page-05.jpg",
            image_error: "",
            audio:
              "audios/page-05.mp3",
          },
          {
            type: "content",
            text: "ÊääÁÉ¶ÊÅº‰∫§ÁªôÂ±±È£éÔºåÊääÂΩºÊ≠§ÁïôÂú®Ë∫´Ëæπ„ÄÇ",
            image: "images/page-06.jpg",
            image_error: "",
            audio:
              "audios/page-06.mp3",
          },
          {
            type: "content",
            text: "‰∏ñÁïå‰∫îÂΩ©ÊñëÊñìÔºåËÄå‰Ω†Â∞±Âú®Ë∫´ÊóÅ„ÄÇ",
            image: "images/page-07.jpeg",
            image_error: "",
            audio:
              "audios/page-07.mp3",
          },
          {
            type: "content",
            text: "Á´ôÂú®‰∫ëÊµ∑‰πã‰∏äÔºåÊàë‰ª¨Âπ∂ËÇ©ÁúãÂêëËøúÊñπ„ÄÇ",
            image: "images/page-08.jpg",
            image_error: "",
            audio:
              "audios/page-08.mp3",
          },
          {
            type: "content",
            text: "Êó∂Èó¥ÊµÅÂä®ÂæóÂæàÂø´ÔºåËÄåËøô‰∏ÄÂàªË¢´Êàë‰ª¨ËÆ∞‰Ωè„ÄÇ",
            image: "images/page-09.jpg",
            image_error: "",
            audio:
              "audios/page-09.mp3",
          },
          {
            type: "content",
            text: "ÊóÖÈÄî‰∏≠ÁöÑ‰∏ÄÂ∫ßÂüéÂ∏ÇÔºå‰πüÂõ†‰∏∫ÂêåË°åËÄåÊúâ‰∫ÜÊÑè‰πâ„ÄÇ",
            image: "images/page-10.jpg",
            image_error: "",
            audio:
              "audios/page-10.mp3",
          },
          {
            type: "content",
            text: "Êàë‰ª¨Âú®Âì™ÂÑøÔºåÂ∞±ÊòØÊúÄÂ•ΩÁöÑÂú∞Êñπ„ÄÇ",
            image: "images/page-11.jpg",
            image_error: "",
            audio:
              "audios/page-11.mp3",
          },
          {
            type: "content",
            text: "‰∏ñÁïåÂÜçÂ§ßÔºå‰πüÊÑøÊÑè‰∏ÄËµ∑ÊÖ¢ÊÖ¢Ëµ∞„ÄÇ",
            image: "images/page-12.jpg",
            image_error: "",
            audio:
              "audios/page-12.mp3",
          },
          {
            type: "content",
            text: "ÊóÖÈÄî‰πãÂ§ñÔºåÊàë‰ª¨‰πüËÆ§ÁúüËøáÂ•ΩÊØè‰∏ÄÂ§©„ÄÇ",
            image: "images/page-13.png",
            image_error: "",
            audio:
              "audios/page-13.mp3",
          },
          {
            type: "content",
            text: "‰∏∫‰∫Ü‰∏ÄÂè™Â®ÉÂ®ÉÂ±è‰ΩèÂëºÂê∏ÁöÑÂá†ÁßíÔºåÊòØÁîüÊ¥ªÈáåËΩªÁõàÁöÑÂø´‰πê„ÄÇ",
            image: "images/page-14.jpg",
            image_error: "",
            audio:
              "audios/page-14.mp3",
          },
          {
            type: "content",
            text: "‰ªéÁîüÊ¥ªÂà∞‰∏ñÁïåÔºåÊàë‰ª¨‰∏ÄËµ∑ÁúãËßÅÊõ¥Â§ßÁöÑÂèØËÉΩ„ÄÇ",
            image: "images/page-15.jpg",
            image_error: "",
            audio:
              "audios/page-15.mp3",
          },
          {
            type: "content",
            text: "‰∏ÄËµ∑Êé¢Á¥¢Êµ∑Ê¥ãÁöÑÂ•áÂ¶ô‰∏ñÁïå„ÄÇ",
            image: "images/page-16.jpg",
            image_error: "",
            audio:
              "audios/page-16.mp3",
          },
          {
            type: "content",
            text: "ÊÖ¢‰∏ÄÁÇπÁöÑÊó∂ÂÖâÔºåËÆ©ÂøÉÈù†ÂæóÊõ¥Ëøë„ÄÇ",
            image: "images/page-17.jpg",
            image_error: "",
            audio:
              "audios/page-17.mp3",
          },
          {
            type: "content",
            text: "Ëµ∞ÂæóÂÜçËøúÔºå‰πüËÆ∞ÂæóÊù•Â§Ñ‰∏éÂÆ∂ÁöÑÊñπÂêë„ÄÇ",
            image: "images/page-18.jpg",
            image_error: "",
            audio:
              "audios/page-18.mp3",
          },
          {
            type: "content",
            text: "Êåâ‰∏ãÂø´Èó®ÁöÑÁû¨Èó¥ÔºåÊàë‰ª¨‰πüÊääËøô‰∏ÄÂàªÁïôÁªô‰∫ÜÊú™Êù•„ÄÇ",
            image: "images/page-19.jpg",
            image_error: "",
            audio:
              "audios/page-19.mp3",
          },
          {
            type: "content",
            text: "Âú®‰∏â‰∫öÁöÑÊµ∑È£éÈáåÔºåÊàë‰ª¨Áü•ÈÅì‚Äî‚ÄîÁæéÂ•ΩÊú™Êù•ÔºåËøòÂú®ÁªßÁª≠„ÄÇ",
            image: "images/page-20.jpg",
            image_error: "",
            audio:
              "audios/page-20.mp3",
          },
        ],
      };

      // ÊâìÂç∞È°µÈÄöËøá postMessage ËØ∑Ê±ÇÈÖçÁΩÆÔºåÈÅøÂÖç file:// ‰∏ãË∑®ÂüüÊó†Ê≥ïËØª opener
      window.addEventListener("message", function (e) {
        if (e.data && e.data.type === "REQUEST_CONFIG") {
          e.source.postMessage(
            { type: "PICTUREBOOK_CONFIG", config: PICTUREBOOK_CONFIG },
            "*"
          );
        }
      });

      // DOM Elements
      const book = document.getElementById("book");
      const baseLeft = document.getElementById("base-left");
      const baseRight = document.getElementById("base-right");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const playPauseBtn = document.getElementById("playPauseBtn");
      const playIcon = document.getElementById("playIcon");
      const muteBtn = document.getElementById("muteBtn");
      const audioPlayer = document.getElementById("audioPlayer");
      const bgmPlayer = document.getElementById("bgmPlayer");
      const progressBar = document.getElementById("progressBar");
      const mobileBookContainer = document.getElementById(
        "mobile-book-container"
      );

      // State
      let currentIndex = 0;
      let totalSheets = 0; // For desktop, this is numPages - 1
      let totalMobilePages = 0; // For mobile, this is numPages
      let isAutoPlaying = false;
      let isMuted = false;

      // Set background music volume
      bgmPlayer.volume = 0.3;

      // Toast notification helper
      function showToast(message, isProminent = false) {
        const toast = document.createElement("div");
        toast.className = "toast" + (isProminent ? " prominent" : "");
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(
          () => {
            toast.classList.add("hide");
            setTimeout(() => {
              document.body.removeChild(toast);
            }, 500);
          },
          isProminent ? 5000 : 3000
        );
      }

      const shareTipBanner = document.getElementById("shareTipBanner");
      function dismissShareTip() {
        if (!shareTipBanner) return;
        shareTipBanner.classList.add("hidden");
        try {
          localStorage.setItem("share_tip_banner_dismissed", "1");
        } catch (e) {}
      }

      function updateShareTipVisibility() {
        if (!shareTipBanner) return;
        try {
          if (localStorage.getItem("share_tip_banner_dismissed") === "1") {
            shareTipBanner.classList.add("hidden");
            return;
          }
        } catch (e) {}

        if (currentIndex === 0) {
          shareTipBanner.classList.remove("hidden");
        } else {
          shareTipBanner.classList.add("hidden");
        }
      }

      try {
        if (localStorage.getItem("share_tip_banner_dismissed") === "1") {
          if (shareTipBanner) shareTipBanner.classList.add("hidden");
        }
      } catch (e) {}

      function getImageContent(pageIndex) {
        const page = PICTUREBOOK_CONFIG.pages[pageIndex];
        if (!page) return "";

        const imageError =
          !page.image && page.image_error
            ? String(page.image_error).trim()
            : "";
        const errorText = imageError || "ÊúçÂä°ÁπÅÂøôÔºåËØ∑Á®çÂêéÈáçËØï";

        // Cover Page Image (Full Sheet)
        if (page.type === "cover") {
          const imageBlock = page.image
            ? `<img src="${page.image}" class="cover-image" alt="Cover">`
            : `<div class="image-placeholder"><div class="image-error-text">${errorText}</div></div>`;
          return `
                    ${imageBlock}
                    <div class="cover-overlay">
                        <h1>${page.title}</h1>
                        <h2>${page.author}</h2>
                        ${
                          page.image
                            ? ""
                            : `<div class="cover-error">${errorText}</div>`
                        }
                    </div>
                `;
        }

        if (page.image) {
          return `<img src="${page.image}" class="page-image" alt="Page ${pageIndex}">`;
        }
        return `<div class="image-placeholder"><div class="image-error-text">${errorText}</div></div>`;
      }

      function getTextContent(pageIndex) {
        const page = PICTUREBOOK_CONFIG.pages[pageIndex];
        if (!page) return "";

        const text = page.text || "";
        const isBackCover = page.type === "back_cover";
        const trimmedText = text.trim();
        let lengthClass = "medium-text";
        if (text.length < 10) lengthClass = "short-text";
        else if (text.length > 50) lengthClass = "extra-long-text";
        else if (text.length > 30) lengthClass = "long-text";

        if (pageIndex === PICTUREBOOK_CONFIG.pages.length - 1) {
          return `
                    <div class="page-text-container ${lengthClass}">
                        ${isBackCover || !trimmedText ? "" : `<p>${text}</p>`}
                        <button class="restart-btn" onclick="restartBook()">‚Üª ‰ªéÂ§¥ÂºÄÂßã</button>
                        <div class="page-number">${pageIndex} / ${
            PICTUREBOOK_CONFIG.pages.length - 1
          }</div>
                    </div>
                `;
        }

        return `
                <div class="page-text-container ${lengthClass}">
                    ${isBackCover || !trimmedText ? "" : `<p>${text}</p>`}
                    <div class="page-number">${pageIndex} / ${
          PICTUREBOOK_CONFIG.pages.length - 1
        }</div>
                </div>
            `;
      }

      function showText(index) {
        // Find the text container for the current spread
        // If index=0 (Cover), no page-text-container usually (it's cover-overlay)
        // If index=1 (Page 1), text is on Sheet 1 Front.
        if (index > 0 && index < totalSheets) {
          const sheet = document.getElementById(`sheet-${index}`);
          const textContainer = sheet.querySelector(".page-text-container");
          if (textContainer) {
            // Delay adding the class to allow page flip to start
            setTimeout(() => {
              textContainer.classList.add("visible");
            }, 600); // 0.6s delay (halfway through 1s flip)
          }
        } else if (index === totalSheets) {
          // Last page (Base Right)
          const baseRight = document.getElementById("base-right");
          const textContainer = baseRight.querySelector(".page-text-container");
          if (textContainer) {
            setTimeout(() => {
              textContainer.classList.add("visible");
            }, 600);
          }
        }
      }

      function initDesktopBook() {
        const pages = PICTUREBOOK_CONFIG.pages;
        const numPages = pages.length;

        // Logic:
        // Sheet 0: Front = Cover Image (Full), Back = Page 1 Image (Left side of Spread 1)
        // Sheet 1: Front = Page 1 Text (Right side of Spread 1), Back = Page 2 Image
        // ...
        // Sheet i: Front = Page i Text, Back = Page i+1 Image

        // Total Sheets = numPages - 1 (Cover is Sheet 0, Page 1 is Sheet 1... Last Page Text is Base Right)
        // Wait, if Page 0 is Cover.
        // Sheet 0 Front: Cover.
        // Sheet 0 Back: Page 1 Image.
        // Sheet 1 Front: Page 1 Text.
        // Sheet 1 Back: Page 2 Image.

        totalSheets = numPages - 1;

        baseLeft.innerHTML = "";
        baseRight.innerHTML = getTextContent(numPages - 1);

        // Clean up any existing sheets from previous initializations
        const existingSheets = book.querySelectorAll(".sheet");
        existingSheets.forEach((sheet) => sheet.remove());

        for (let i = 0; i < totalSheets; i++) {
          const sheet = document.createElement("div");
          sheet.className = "sheet";
          sheet.id = `sheet-${i}`;
          sheet.style.zIndex = (totalSheets - i) * 10;

          const front = document.createElement("div");
          front.className = "sheet-face sheet-front";

          const back = document.createElement("div");
          back.className = "sheet-face sheet-back";

          if (i === 0) {
            // Cover Sheet
            front.innerHTML = getImageContent(0); // Cover Image
            back.innerHTML = getImageContent(1); // Page 1 Image
          } else {
            // Content Sheets
            front.innerHTML = getTextContent(i); // Page i Text
            back.innerHTML = getImageContent(i + 1); // Page i+1 Image
          }

          sheet.appendChild(front);
          sheet.appendChild(back);

          front.addEventListener("click", (e) => {
            if (i === currentIndex) nextPage();
          });

          back.addEventListener("click", (e) => {
            if (i === currentIndex - 1) prevPage();
          });

          book.appendChild(sheet);
        }

        updateControls();
        updateProgress();
      }

      // Initial check for cover text visibility
      setTimeout(() => {
        const coverText = document.querySelector("#sheet-0 .cover-overlay");
        if (coverText) coverText.classList.add("visible"); // If we want cover to fade in too
        // Or if cover is special, we might not need this class if it's not .page-text-container
      }, 100);

      /* --- Mobile Logic --- */
      function initMobileBook() {
        mobileBookContainer.innerHTML = ""; // Clear

        // Generate Sheets Loop
        // Logic: Each Page config = One Mobile Sheet (Image + Text)
        // Stack Order: Page 0 (Cover) is Top (Highest Z). Page Last is Bottom.
        const pages = PICTUREBOOK_CONFIG.pages;
        totalMobilePages = pages.length;

        pages.forEach((page, index) => {
          const sheet = document.createElement("div");
          sheet.className = "mobile-sheet";
          sheet.id = `mobile-sheet-${index}`;
          sheet.style.zIndex = (totalMobilePages - index) * 10;

          if (page.type === "cover" || index === 0) {
            sheet.classList.add("is-cover");
            const coverError =
              !page.image && page.image_error
                ? String(page.image_error).trim()
                : "";
            const coverErrorText = coverError || "ÊúçÂä°ÁπÅÂøôÔºåËØ∑Á®çÂêéÈáçËØï";
            const coverImageBlock = page.image
              ? `<img src="${page.image}">`
              : `<div class="image-placeholder"><div class="image-error-text">${coverErrorText}</div></div>`;
            sheet.innerHTML = `
                        <div class="mobile-image-area">
                            ${coverImageBlock}
                            <div class="mobile-cover-title">
                                <h1>${page.title}</h1>
                                <p>${page.author}</p>
                            </div>
                        </div>
                    `;
          } else if (page.type === "back_cover") {
            const backError =
              !page.image && page.image_error
                ? String(page.image_error).trim()
                : "";
            const backErrorText = backError || "ÊúçÂä°ÁπÅÂøôÔºåËØ∑Á®çÂêéÈáçËØï";
            const backImageBlock = page.image
              ? `<img src="${page.image}" loading="lazy">`
              : `<div class="image-placeholder"><div class="image-error-text">${backErrorText}</div></div>`;
            sheet.innerHTML = `
                        <div class="mobile-image-area">
                            ${backImageBlock}
                        </div>
                        <div class="mobile-text-area short-text">
                            <button class="restart-btn" onclick="restartBook()">‚Üª ‰ªéÂ§¥ÂºÄÂßã</button>
                             <div class="page-number" style="text-align:right; margin-top:20px; opacity:0.5; font-size:12px;">${index} / ${
              totalMobilePages - 1
            }</div>
                        </div>
                    `;
          } else {
            const text = page.text || "";
            let lengthClass = "medium-text";
            if (text.length < 10) lengthClass = "short-text";
            else if (text.length > 50) lengthClass = "extra-long-text";
            else if (text.length > 30) lengthClass = "long-text";

            let textContent = `<p>${text}</p>`;
            if (index === totalMobilePages - 1) {
              textContent += `<button class="restart-btn" onclick="restartBook()">‚Üª ‰ªéÂ§¥ÂºÄÂßã</button>`;
            }

            const pageError =
              !page.image && page.image_error
                ? String(page.image_error).trim()
                : "";
            const pageErrorText = pageError || "ÊúçÂä°ÁπÅÂøôÔºåËØ∑Á®çÂêéÈáçËØï";
            const pageImageBlock = page.image
              ? `<img src="${page.image}" loading="lazy">`
              : `<div class="image-placeholder"><div class="image-error-text">${pageErrorText}</div></div>`;
            sheet.innerHTML = `
                        <div class="mobile-image-area">
                            ${pageImageBlock}
                        </div>
                        <div class="mobile-text-area ${lengthClass}">
                            ${textContent}
                             <div class="page-number" style="text-align:right; margin-top:20px; opacity:0.5; font-size:12px;">${index} / ${
              totalMobilePages - 1
            }</div>
                        </div>
                    `;
          }

          // Tap to Flip
          sheet.addEventListener("click", (e) => {
            // Click acts as Next
            // Only top visible sheet triggers?
            // Since we stack by z-index, top one receives click.
            // Ensure click is only for the current active sheet
            if (index === currentIndex) {
              nextPage();
            }
          });

          mobileBookContainer.appendChild(sheet);
        });

        // --- Swipe Gesture Support ---
        let touchStartX = 0;
        let touchEndX = 0;
        const swipeThreshold = 50; // Minimum swipe distance in pixels

        mobileBookContainer.addEventListener(
          "touchstart",
          (e) => {
            touchStartX = e.changedTouches[0].screenX;
          },
          { passive: true }
        );

        mobileBookContainer.addEventListener(
          "touchend",
          (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
          },
          { passive: true }
        );

        function handleSwipe() {
          const swipeDistance = touchEndX - touchStartX;
          if (Math.abs(swipeDistance) < swipeThreshold) return; // Ignore small movements

          if (swipeDistance < 0) {
            // Swipe Left -> Next Page
            nextPage();
          } else {
            // Swipe Right -> Previous Page
            prevPage();
          }
        }

        updateMobileView(currentIndex);
        updateControls();
        updateProgress();
      }

      function updateMobileView(index) {
        // "Flipping" logic:
        // Sheets 0 to index-1 should be "flipped" (rotated away).
        // Sheet index should be "visible" (not flipped).
        // Sheets index+1 ... should be visible (underneath).

        for (let i = 0; i < PICTUREBOOK_CONFIG.pages.length; i++) {
          const sheet = document.getElementById(`mobile-sheet-${i}`);
          if (!sheet) continue;

          const isVisible = Math.abs(i - index) <= 1;
          sheet.style.display = isVisible ? "flex" : "none";

          if (i < index) {
            sheet.classList.add("flipped");
          } else {
            sheet.classList.remove("flipped");
          }
        }
      }

      // --- Navigation Delegates ---
      function nextPage() {
        const isMobile = window.innerWidth < 768;
        const maxIndex = isMobile ? totalMobilePages - 1 : totalSheets; // Max index for mobile is last page, for desktop it's last sheet

        if (currentIndex < maxIndex) {
          currentIndex++;

          if (isMobile) {
            updateMobileView(currentIndex);
          } else {
            const sheet = document.getElementById(`sheet-${currentIndex - 1}`); // Desktop sheets are 0..N-1
            if (sheet) sheet.classList.add("flipped");
            showText(currentIndex);
          }

          updateControls();
          updateProgress();
          playAudio(currentIndex);
        }
      }

      function prevPage() {
        if (currentIndex > 0) {
          currentIndex--;

          const isMobile = window.innerWidth < 768;
          if (isMobile) {
            updateMobileView(currentIndex);
          } else {
            const sheet = document.getElementById(`sheet-${currentIndex}`);
            if (sheet) sheet.classList.remove("flipped");
            showText(currentIndex);
          }

          updateControls();
          updateProgress();

          if (currentIndex > 0) {
            playAudio(currentIndex);
          } else {
            audioPlayer.pause();
          }
        }
      }

      function restartBook() {
        stopAutoPlay();
        currentIndex = 0;

        const isMobile = window.innerWidth < 768;
        if (isMobile) {
          updateMobileView(0);
        } else {
          // Desktop reset
          for (let i = 0; i < totalSheets; i++) {
            const sheet = document.getElementById(`sheet-${i}`);
            if (sheet) sheet.classList.remove("flipped");
          }
        }
        updateControls();
        updateProgress();
        audioPlayer.pause();
      }

      function updateControls() {
        const isMobile = window.innerWidth < 768;
        const maxIndex = isMobile ? totalMobilePages - 1 : totalSheets;

        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === maxIndex;

        // Handle Centering (Skip on mobile to avoid layout shifts)
        if (!isMobile) {
          if (currentIndex === 0) {
            book.classList.add("closed");
          } else {
            book.classList.remove("closed");
          }

          for (let i = 0; i < totalSheets; i++) {
            const sheet = document.getElementById(`sheet-${i}`);
            if (!sheet) continue;

            if (i < currentIndex) {
              // Already flipped to the left
              sheet.style.zIndex = i + 10;
              // Only the most recently flipped sheet (on the left) should be interactive
              sheet.style.pointerEvents =
                i === currentIndex - 1 ? "auto" : "none";
            } else {
              // Still on the right
              sheet.style.zIndex = totalSheets - i + 10;
              // Only the top sheet on the right should be interactive
              sheet.style.pointerEvents = i === currentIndex ? "auto" : "none";
            }
          }
        }

        updateShareTipVisibility();
      }

      function updateProgress() {
        const isMobile = window.innerWidth < 768;
        const totalPagesForProgress = isMobile ? totalMobilePages : totalSheets;
        const progress = (currentIndex / totalPagesForProgress) * 100;
        progressBar.style.transform = `scaleX(${progress / 100})`;
      }

      function playAudio(pageIndex) {
        const page = PICTUREBOOK_CONFIG.pages[pageIndex];

        audioPlayer.pause();
        audioPlayer.currentTime = 0;

        if (page && page.audio) {
          audioPlayer.src = page.audio;
          audioPlayer.muted = isMuted;

          if (isAutoPlaying) {
            audioPlayer
              .play()
              .catch((e) => console.log("Auto-play blocked:", e));
          }
        } else {
          if (isAutoPlaying) {
            setTimeout(() => {
              if (isAutoPlaying) nextPage();
            }, 3000);
          }
        }
      }

      function toggleAutoPlay() {
        isAutoPlaying = !isAutoPlaying;

        if (isAutoPlaying) {
          playPauseBtn.classList.add("active");
          playIcon.textContent = "‚è∏";
          playPauseBtn.querySelector("span:last-child").textContent =
            "ÊöÇÂÅúÊí≠Êîæ";

          // Start background music
          bgmPlayer.muted = isMuted;
          bgmPlayer.play().catch((e) => console.log("BGM play blocked:", e));

          // If on cover page, always jump to first page when starting autoplay
          if (currentIndex === 0) {
            nextPage();
          } else if (audioPlayer.src) {
            audioPlayer.play();
          } else {
            playAudio(currentIndex);
          }
        } else {
          playPauseBtn.classList.remove("active");
          playIcon.textContent = "‚ñ∂";
          playPauseBtn.querySelector("span:last-child").textContent =
            "Ëá™Âä®Êí≠Êîæ";
          audioPlayer.pause();

          // Stop background music
          bgmPlayer.pause();
          bgmPlayer.currentTime = 0;
        }
      }

      function toggleMute() {
        isMuted = !isMuted;
        audioPlayer.muted = isMuted;
        bgmPlayer.muted = isMuted;
        muteBtn.textContent = isMuted ? "üîá" : "üîä";
        muteBtn.classList.toggle("active", isMuted);
        showToast(isMuted ? "Â∑≤ÈùôÈü≥" : "Â£∞Èü≥Â∑≤ÂºÄÂêØ");
      }

      prevBtn.addEventListener("click", () => {
        stopAutoPlay();
        prevPage();
      });

      nextBtn.addEventListener("click", () => {
        stopAutoPlay();
        nextPage();
      });

      playPauseBtn.addEventListener("click", toggleAutoPlay);
      muteBtn.addEventListener("click", toggleMute);

      audioPlayer.addEventListener("ended", () => {
        if (isAutoPlaying) {
          // Check if this is the last page
          const isMobile = window.innerWidth < 768;
          const maxIndex = isMobile ? totalMobilePages - 1 : totalSheets;

          if (currentIndex >= maxIndex) {
            // Stop background music when story ends
            bgmPlayer.pause();
            bgmPlayer.currentTime = 0;
          }

          setTimeout(() => {
            if (isAutoPlaying) nextPage();
          }, 1000);
        }
      });

      function stopAutoPlay() {
        if (isAutoPlaying) {
          toggleAutoPlay();
        }
      }

      document.addEventListener("keydown", (e) => {
        // Ignore shortcuts if the user is typing in a form field
        if (
          ["INPUT", "TEXTAREA", "SELECT"].includes(
            document.activeElement.tagName
          )
        ) {
          return;
        }

        if (e.key === "ArrowRight") {
          stopAutoPlay();
          nextPage();
        }
        if (e.key === "ArrowLeft") {
          stopAutoPlay();
          prevPage();
        }
        if (e.key === " ") {
          e.preventDefault();
          toggleAutoPlay();
        }
      });

      function initializeBookView() {
        if (window.innerWidth < 768) {
          initMobileBook();
          book.style.display = "none"; // Ensure desktop book is hidden
          mobileBookContainer.style.display = "block"; // Ensure mobile book is shown
        } else {
          initDesktopBook(); // Desktop Init
          book.style.display = "block"; // Ensure desktop book is shown
          mobileBookContainer.style.display = "none"; // Ensure mobile book is hidden
        }
      }

      initializeBookView(); // Initial call

      // Handle Resize (Optional: Reload if mode changes)
      let currentViewMode = window.innerWidth < 768 ? "mobile" : "desktop";
      window.addEventListener("resize", () => {
        const newViewMode = window.innerWidth < 768 ? "mobile" : "desktop";
        if (newViewMode !== currentViewMode) {
          // Save current book state (which content is visible)
          // Desktop index is spread index (roughly pageIndex / 2)
          // Mobile index is single page index
          let savedPageIndex =
            currentViewMode === "desktop" ? currentIndex * 2 : currentIndex;

          currentViewMode = newViewMode;
          initializeBookView();

          // Restore position in the new mode
          if (newViewMode === "desktop") {
            currentIndex = Math.floor(savedPageIndex / 2);
            // Restore flip states for desktop
            for (let i = 0; i < currentIndex; i++) {
              const sheet = document.getElementById(`sheet-${i}`);
              if (sheet) sheet.classList.add("flipped");
            }
          } else {
            currentIndex = savedPageIndex;
            updateMobileView(currentIndex);
          }

          updateControls();
          updateProgress();
          stopAutoPlay();
        }
      });
    </script>
  </body>
</html>
